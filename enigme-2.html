<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de piste - Enigme 2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .puzzle-container {
            width: 800px; /* Taille totale du puzzle (doit correspondre à la largeur de votre image) */
            height: 800px; /* Taille totale du puzzle (doit correspondre à la hauteur de votre image) */
            margin: 20px auto;
            display: flex;
            flex-wrap: wrap;
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .puzzle-piece {
            width: 80px; /* Taille d'une pièce (largeur totale / 10) */
            height: 80px; /* Taille d'une pièce (hauteur totale / 10) */
            /* Remplacez 'votre-image.jpg' par le nom de votre fichier image */
            background-image: url('puzzle.jpeg');
            border: 1px solid #ccc;
            box-sizing: border-box;
            cursor: grab;
            transition: transform 0.2s ease-in-out;
        }

        .puzzle-piece:active {
            cursor: grabbing;
        }
        
        #next-step {
            margin-top: 20px;
            font-size: 1.5em;
            color: green;
        }

        #next-step a {
            color: #007BFF;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Étape 2 : L'image secrète</h1>
    <p>Réorganisez les pièces de l'image pour révéler la prochaine étape.</p>

    <div class="puzzle-container" id="puzzle-container" ondrop="drop(event)" ondragover="allowDrop(event)">
        </div>

    <div id="next-step" style="display:none;">
        <p>Bravo ! Vous avez résolu l'énigme. Cliquez ici pour la suite :</p>
        <a id="next-link" href="URL_DE_LA_PROCHAINE_PAGE">Prochaine Étape</a>
    </div>

    <script>
        const puzzleContainer = document.getElementById('puzzle-container');
        const nextStepDiv = document.getElementById('next-step');
        
        // Configuration du puzzle
        const numPieces = 100;
        const gridCols = 10;
        const pieceWidth = 80;
        const pieceHeight = 80;
        
        let pieces = [];
        let draggedPiece = null;

        // Créer les 100 pièces du puzzle
        for (let i = 0; i < numPieces; i++) {
            const piece = document.createElement('div');
            piece.classList.add('puzzle-piece');
            piece.setAttribute('data-order', i);
            piece.setAttribute('draggable', 'true');
            piece.style.backgroundPosition = `-${(i % gridCols) * pieceWidth}px -${Math.floor(i / gridCols) * pieceHeight}px`;
            pieces.push(piece);
        }

        // Fonction pour mélanger et afficher les pièces
        function shufflePieces() {
            pieces.sort(() => Math.random() - 0.5);
            pieces.forEach(piece => puzzleContainer.appendChild(piece));
        }

        puzzleContainer.addEventListener('dragstart', (e) => {
            draggedPiece = e.target;
            e.dataTransfer.setData('text/plain', null);
        });

        puzzleContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        puzzleContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('puzzle-piece') && e.target !== draggedPiece) {
                const temp = document.createElement('div');
                puzzleContainer.insertBefore(temp, e.target);
                puzzleContainer.insertBefore(e.target, draggedPiece);
                puzzleContainer.insertBefore(draggedPiece, temp);
                puzzleContainer.removeChild(temp);
                checkWinCondition();
            }
        });

        function checkWinCondition() {
            const currentOrder = Array.from(puzzleContainer.children).map(piece => parseInt(piece.getAttribute('data-order')));
            const correctOrder = Array.from({length: numPieces}, (_, i) => i);

            if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
                nextStepDiv.style.display = 'block';
                puzzleContainer.style.border = "5px solid green";
                puzzleContainer.style.boxShadow = "0 0 15px 5px green";
                // Désactiver le glisser-déposer après la victoire
                puzzleContainer.querySelectorAll('.puzzle-piece').forEach(piece => {
                    piece.draggable = false;
                });
            }
        }
        
        // Lancer le jeu
        shufflePieces();

    </script>
</body>
</html>
