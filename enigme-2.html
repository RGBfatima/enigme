<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de piste - Enigme 2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .main-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .puzzle-container {
            width: 500px;
            height: 500px;
            display: flex;
            flex-wrap: wrap;
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .reference-image-container {
            width: 250px;
            height: 250px;
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .reference-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .puzzle-piece {
            width: 100px;
            height: 100px;
            background-image: url('puzzlee.jpg');
            border: 1px solid #ccc;
            box-sizing: border-box;
            cursor: grab;
            transition: transform 0.2s ease-in-out;
        }

        .puzzle-piece:active {
            cursor: grabbing;
        }
        
        #next-step {
            margin-top: 20px;
            font-size: 1.5em;
            color: green;
        }

        #next-step a {
            color: #007BFF;
            text-decoration: none;
            font-weight: bold;
        }

        .qcm-container {
            margin-top: 20px;
            padding: 20px;
            border: 2px solid #333;
            background-color: #fff;
            text-align: left;
            display: none;
        }

        .qcm-container h3 {
            margin-top: 0;
        }

        .qcm-container button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>

    <h1>Étape 2 : L'image secrète</h1>
    <p>Réorganisez les pièces de l'image pour révéler la prochaine étape.</p>

    <div class="main-container">
        <div class="reference-image-container">
            <img class="reference-image" src="puzzlee.jpg" alt="Vous devez reconstituer ceci">
        </div>
    
        <div class="puzzle-container" id="puzzle-container" ondrop="drop(event)" ondragover="allowDrop(event)">
        </div>
    </div>

    <div id="next-step" style="display:none;">
        <p>Bravo ! Vous avez résolu l'énigme. Répondez aux questions pour passer à la suite :</p>
    </div>

    <div class="qcm-container" id="qcm-container">
        </div>

    <script>
        const puzzleContainer = document.getElementById('puzzle-container');
        const nextStepDiv = document.getElementById('next-step');
        const qcmContainer = document.getElementById('qcm-container');
        
        const numPieces = 25;
        const gridCols = 5;
        const pieceWidth = 100;
        const pieceHeight = 100;
        
        let pieces = [];
        let draggedPiece = null;
        let currentQuestionIndex = 0;

        // Tableau des 10 questions
        const questions = [
            {
                question: "Question 1: Quelle est la couleur du ciel sur l'image ?",
                answers: ["Bleu", "Vert", "Rouge"],
                correctAnswer: "Bleu"
            },
            {
                question: "Question 2: Quel est le fruit présent sur l'image ?",
                answers: ["Pomme", "Orange", "Banane"],
                correctAnswer: "Banane"
            },
            {
                question: "Question 3: Combien d'animaux sont visibles ?",
                answers: ["1", "2", "3"],
                correctAnswer: "2"
            },
            {
                question: "Question 4: Quelle est la forme de l'objet principal ?",
                answers: ["Rond", "Carré", "Triangle"],
                correctAnswer: "Carré"
            },
            {
                question: "Question 5: L'image a-t-elle été prise de jour ou de nuit ?",
                answers: ["De jour", "De nuit"],
                correctAnswer: "De jour"
            },
            {
                question: "Question 6: Y a-t-il une voiture sur l'image ?",
                answers: ["Oui", "Non"],
                correctAnswer: "Non"
            },
            {
                question: "Question 7: Quel type d'arbre voit-on ?",
                answers: ["Feuillu", "Conifère", "Palmier"],
                correctAnswer: "Feuillu"
            },
            {
                question: "Question 8: La scène se déroule-t-elle en ville ou à la campagne ?",
                answers: ["En ville", "À la campagne"],
                correctAnswer: "À la campagne"
            },
            {
                question: "Question 9: Laquelle de ces couleurs domine l'image ?",
                answers: ["Jaune", "Bleu", "Brun"],
                correctAnswer: "Bleu"
            },
            {
                question: "Question 10: Y a-t-il un pont sur l'image ?",
                answers: ["Oui", "Non"],
                correctAnswer: "Oui"
            }
        ];

        for (let i = 0; i < numPieces; i++) {
            const piece = document.createElement('div');
            piece.classList.add('puzzle-piece');
            piece.setAttribute('data-order', i);
            piece.setAttribute('draggable', 'true');
            piece.style.backgroundPosition = `-${(i % gridCols) * pieceWidth}px -${Math.floor(i / gridCols) * pieceHeight}px`;
            pieces.push(piece);
        }

        function shufflePieces() {
            pieces.sort(() => Math.random() - 0.5);
            pieces.forEach(piece => puzzleContainer.appendChild(piece));
        }

        puzzleContainer.addEventListener('dragstart', (e) => {
            draggedPiece = e.target;
            e.dataTransfer.setData('text/plain', null);
        });

        puzzleContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        puzzleContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('puzzle-piece') && e.target !== draggedPiece) {
                const temp = document.createElement('div');
                puzzleContainer.insertBefore(temp, e.target);
                puzzleContainer.insertBefore(e.target, draggedPiece);
                puzzleContainer.insertBefore(draggedPiece, temp);
                puzzleContainer.removeChild(temp);
                checkWinCondition();
            }
        });

        function checkWinCondition() {
            const currentOrder = Array.from(puzzleContainer.children).map(piece => parseInt(piece.getAttribute('data-order')));
            const correctOrder = Array.from({length: numPieces}, (_, i) => i);

            if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
                nextStepDiv.style.display = 'block';
                puzzleContainer.style.border = "5px solid green";
                puzzleContainer.style.boxShadow = "0 0 15px 5px green";
                puzzleContainer.querySelectorAll('.puzzle-piece').forEach(piece => {
                    piece.draggable = false;
                });
                displayQuestion();
            }
        }
        
        function displayQuestion() {
            qcmContainer.innerHTML = '';
            if (currentQuestionIndex < questions.length) {
                qcmContainer.style.display = 'block';
                const currentQuestion = questions[currentQuestionIndex];
                
                const questionHTML = `
                    <h3>${currentQuestion.question}</h3>
                    <p>Choisissez la bonne réponse :</p>
                `;
                qcmContainer.innerHTML = questionHTML;

                currentQuestion.answers.forEach(answer => {
                    const button = document.createElement('button');
                    button.textContent = answer;
                    button.onclick = () => checkAnswer(answer, currentQuestion.correctAnswer);
                    qcmContainer.appendChild(button);
                });
            } else {
                alert("Félicitations ! Vous avez répondu à toutes les questions correctement.");
            }
        }

        function checkAnswer(selectedAnswer, correctAnswer) {
            if (selectedAnswer === correctAnswer) {
                alert("Bonne réponse !");
                currentQuestionIndex++;
                displayQuestion();
            } else {
                alert("Mauvaise réponse. Vous devez recommencer le puzzle.");
                window.location.href = "index.html?new_game=true";
            }
        }

        window.checkAnswer = checkAnswer;
        
        shufflePieces();
    </script>
</body>
</html>
