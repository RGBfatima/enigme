<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vica ❤️</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      min-height:100vh;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      display:flex;
      justify-content:center;
      align-items:center;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container { text-align:center; position:relative; z-index:10; }
    #startButton {
      background: linear-gradient(45deg,#f093fb 0%,#f5576c 100%);
      color:white; border:none;
      padding:20px 50px; font-size:24px; font-weight:bold;
      border-radius:50px; cursor:pointer;
      box-shadow:0 10px 30px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      letter-spacing:1px; animation:pulse 2s infinite;
      position:relative; z-index:100;
      min-width:280px; min-height:70px;
      display:inline-block;
    }
    #startButton:hover { transform:translateY(-3px); box-shadow:0 15px 40px rgba(0,0,0,0.4); }
    #startButton:active { transform:translateY(0px); box-shadow:0 8px 25px rgba(0,0,0,0.3); }
    @keyframes pulse { 0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);} }

    #heartContainer { position:relative; opacity:0; transition:opacity 1s ease; z-index:50; }
    #heartContainer.show { opacity:1; }
    canvas { filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3)); animation:heartbeat 1.5s ease-in-out infinite; animation-delay:1.5s; pointer-events:none; }
    @keyframes heartbeat { 0%{transform:scale(1);} 14%{transform:scale(1.1);} 28%{transform:scale(1);} 42%{transform:scale(1.1);} 70%{transform:scale(1);} }

    .particle { position:fixed; pointer-events:none; opacity:0; animation:float 4s ease-out forwards; z-index:1; }
    @keyframes float { 0%{opacity:1; transform:translateY(0) scale(0);} 15%{transform:translateY(-20px) scale(1);} 100%{opacity:0; transform:translateY(-150px) translateX(var(--drift)) scale(0.5);} }
    .heart-small { color:#ff1744; font-size:20px; }

    /* étape décodage */
    #decodeStep { margin-top:20px; display:none; }
    #hintBase64 { color:#fff; margin-bottom:6px; }
    #decodeInput { padding:10px 14px; border-radius:8px; border:none; font-size:16px; min-width:260px; }

    /* rebus */
        #rebus {
      display: none;
      margin-top: 20px;
      color: #fff;
      text-align: center;
      font-family: 'Poppins', sans-serif;
      line-height: 1.8;
    }
    
    #rebus .r-line {
      font-size: 22px;
      font-weight: 500;
      margin: 8px 0;
      background: linear-gradient(90deg, #ff758c, #ff7eb3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    #rebus .r-line:hover {
      transform: translateY(-3px);
      opacity: 0.9;
    }


    /* toast copie */
    #copyToast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: #fff;
      padding: 8px 16px; border-radius: 8px; display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <button id="startButton">T'es prête bew?</button>
    <div id="heartContainer">
      <canvas id="heartCanvas"></canvas>
      <div id="decodeStep">
        <div id="hintBase64">(Base64) SmUgdCdhaW1lIG1vbiBjxZN1ciDinaTvuI8gbGEgY2zDqSBkZSBsJ8OpbmlnbWU6</div>
        <input id="decodeInput" type="text" placeholder="Tape ici..." />
      </div>
      <div id="rebus">
        <div class="r-line">Mon premier = première lettre de mon prénom, décalage -15</div>
        <div class="r-line">Mon deuxième = allitération dans "Ton tonton et ta tata t'ont trouvé très travelo"</div>
        <div class="r-line">Mon troisième = lettre au même indice dans l'acronyme de ton école</div>
        <div class="r-line">Mon quatrième = première lettre de ta meilleure amie & ma petite sœur</div>
        <div class="r-line">Mon cinquième = (7²−sqrt(144))×10/5+(3×5)−46 (code ASCII)</div>
        <div class="r-line">Mon sixième = meme célèbre de Denis Brogniart (Koh Lanta)</div>
        <div class="r-line">Mon tout = une commande à taper sur le clavier</div>
      </div>
    </div>
  </div>
  <div id="copyToast">Code secret copié ✅</div>

  <script>
    const button = document.getElementById("startButton");
    const heartContainer = document.getElementById("heartContainer");
    const decodeStep = document.getElementById("decodeStep");
    const decodeInput = document.getElementById("decodeInput");
    const rebus = document.getElementById("rebus");
    const toast = document.getElementById("copyToast");
    const canvas = document.getElementById("heartCanvas");
    const ctx = canvas.getContext("2d");

    const correctPhrase = "Je t'aime mon cœur ❤️ la clé de l'énigme:";
    const secretCode = "1iQagj-WOVjFlJr-bJvvPszqExAnpjK4w";

    // === Cœur pixelisé ===
    const pixelSize=8;
    const heartPattern=[
      '    ####    ####    ','  ################  ',' ################## ','####################',
      '####################','####################','####################','####################',
      ' ################## ','  ################ ','   ############## ','    ############ ',
      '     ########## ','      ######## ','       ###### ','        #### ','         ## '
    ];
    const highlightPattern=[
      '     #              ','    ##              ','     #              ','                    ',
      '                    ','                    ','                    ','                    ',
      '                    ','                    ','                    ','                    ',
      '                    ','                    ','                    ','                    ','                    ','                    '
    ];
    canvas.width=heartPattern[0].length*pixelSize;
    canvas.height=heartPattern.length*pixelSize;

    function drawPixel(x,y,color){ctx.fillStyle=color;ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);}
    function isEdge(x,y){const dirs=[[-1,0],[1,0],[0,-1],[0,1]];for(const [dx,dy] of dirs){const nx=x+dx,ny=y+dy;if(ny<0||ny>=heartPattern.length||nx<0||nx>=heartPattern[ny].length||heartPattern[ny][nx]!=='#')return true;}return false;}
    function getTotalPixels(){return heartPattern.reduce((acc,row)=>acc+row.split("").filter(ch=>ch==="#").length,0);}
    function drawHeart(progress){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let pixelsToShow=Math.floor(progress*getTotalPixels()),pixelsDrawn=0;
      for(let y=0;y<heartPattern.length;y++){
        for(let x=0;x<heartPattern[y].length;x++){
          if(heartPattern[y][x]==="#" && pixelsDrawn<pixelsToShow){
            drawPixel(x,y,'#DC143C');
            if(isEdge(x,y)){ctx.fillStyle='rgba(0,0,0,0.3)';ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);}
            if(highlightPattern[y] && highlightPattern[y][x]==="#"){ctx.fillStyle='rgba(255,255,255,0.6)';ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);}
            pixelsDrawn++;
          }
        }
      }
    }

    function createParticle(x,y){const p=document.createElement('div');p.className='particle heart-small';p.innerHTML='❤️';p.style.left=x+'px';p.style.top=y+'px';p.style.setProperty('--drift',(Math.random()-0.5)*100+'px');document.body.appendChild(p);setTimeout(()=>p.remove(),4000);}
    
    button.addEventListener("click",()=>{
      button.style.display="none"; heartContainer.classList.add("show");
      let start=Date.now(),duration=1500;
      function anim(){
        let t=Math.min((Date.now()-start)/duration,1);
        drawHeart(1-Math.pow(1-t,3));
        if(t<1) requestAnimationFrame(anim);
        else{for(let i=0;i<15;i++){setTimeout(()=>{const rect=canvas.getBoundingClientRect();createParticle(rect.left+rect.width/2+(Math.random()-0.5)*200,rect.top+rect.height/2+(Math.random()-0.5)*200);},i*100);}
             setTimeout(()=>{decodeStep.style.display="block";},1000);}
      }
      anim();
    });

    decodeInput.addEventListener("input",()=>{if(normalize(decodeInput.value)===normalize(correctPhrase)){decodeStep.style.display="none";rebus.style.display="block";}});

    window.addEventListener("keydown",async(e)=>{const isMac=/MAC/i.test(navigator.platform);const ctrlOrCmd=isMac?e.metaKey:e.ctrlKey;if(ctrlOrCmd&&(e.key==="a"||e.key==="A")){if(rebus.style.display==="block"){e.preventDefault();try{await navigator.clipboard.writeText(secretCode);showToast("Code secret copié ✅");}catch{showToast("Impossible de copier");}}}});

    function showToast(msg){toast.textContent=msg;toast.style.display="block";setTimeout(()=>{toast.style.display="none";},1000);}
    function normalize(str){return str.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim();}

    setInterval(()=>{if(heartContainer.classList.contains('show')){createParticle(Math.random()*window.innerWidth,Math.random()*window.innerHeight);}},2000);
  </script>
</body>
</html>
